# Azure Developer CLI configuration for PoReflex
# https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/

name: poreflex
metadata:
  template: PoReflex-template@0.0.1

# Service definitions - uses existing shared infrastructure
services:
  api:
    project: ./src/Po.Reflex.Api
    language: dotnet
    host: appservice
    resourceName: poreflex-api
    
  web:
    project: ./src/Po.Reflex.Web
    language: js
    host: staticwebapp
    resourceName: poreflex-web
    dist: dist

# Resource groups
resourceGroups:
  app: PoReflex
  shared: PoShared

# Hooks for custom scripts
hooks:
  preprovision:
    shell: pwsh
    run: |
      Write-Host "Using existing resources in PoShared and PoReflex resource groups..."
      
  postprovision:
    shell: pwsh
    run: |
      Write-Host "Resources configured successfully!"
      Write-Host "API URL: https://app-poreflex-api.azurewebsites.net"
      Write-Host "Web URL: https://witty-desert-0679bc00f.2.azurestaticapps.net"
      
  predeploy:
    shell: pwsh
    run: |
      Write-Host "Building and preparing for deployment..."
      dotnet build --configuration Release ./src/Po.Reflex.Api
      Push-Location ./src/Po.Reflex.Web
      npm ci
      npm run build
      Pop-Location
      
  postdeploy:
    shell: pwsh
    run: |
      Write-Host "Deployment complete!"
      Write-Host "API: https://app-poreflex-api.azurewebsites.net/health"
      Write-Host "Web: https://witty-desert-0679bc00f.2.azurestaticapps.net"
